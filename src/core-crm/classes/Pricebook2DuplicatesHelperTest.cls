/**
 * @description Test class for Pricebook2DuplicatesHelper
 * @see Pricebook2DuplicatesHelper
 *
 * @author Accenture
 *
 * @history
 *
 *    | Developer Email                | Date                  | JIRA                   | Change Summary               |
      |--------------------------------|-----------------------|------------------------|------------------------------|
      | kathy.cornejo                  | June 03, 2022         | DEPP-2664              | Created file                 |
 */
@IsTest(SeeAllData = false)
public with sharing class Pricebook2DuplicatesHelperTest {
	private static User currentUser = TestDataFactory.createUserRecords(1, 'QUTeX').iterator().next();
        
    @TestSetUp
    static void setUpMethod(){
    	Pricebook2 pb = new Pricebook2();
        pb.Name = 'TestPb';
        insert pb;
    }
    @IsTest
    static void checkPbName(){
        System.runAs(currentUser) {
            Test.startTest();
            
            Set<String> pricebooks = new Set<String>();
            Pricebook2 pbToAdd = TestDataFactory.createTestPricebook2(false);
            pricebooks.add(pbToAdd.Name);
            insert(pbToAdd);
            
            List<Pricebook2> setPricebook2Name = new List<Pricebook2>();
      
            for(Pricebook2 pbName: [Select Name from Pricebook2 Where Name IN : pricebooks]){
				setPricebook2Name.add(pbName); 
            }
            
            Pricebook2DuplicatesHelper.detectPricebook2Duplicates(pricebooks, setPricebook2Name);  
            
            List<Pricebook2> pbList = [Select Id From Pricebook2 Where Name = 'Test Pricebook2'];
                   
            Test.stopTest();
            
            system.assertEquals(1, pbList.size(), 'Pricebook with duplicate name is invalid'); 
        }
    }
}