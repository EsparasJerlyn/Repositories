<template>
  <template if:true={modalOpen}>

  
  <section role="dialog" tabindex="-1" aria-modal="true" aria-labelledby="modal-heading-01"
  class={modalClass}>
    <div class="slds-modal__container">
      <button onclick={closeModal} class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse">
        <svg class="slds-button__icon slds-button__icon_large" aria-hidden="true">
          <use xlink:href="/assets/icons/utility-sprite/svg/symbols.svg#close"></use>
        </svg>
        <span class="slds-assistive-text">Cancel and close</span>
      </button>
      <div class="slds-modal__header">
        <h1 id="modal-heading-01" class="slds-modal__title slds-hyphenate">Import List</h1>
      </div>
      <div class="slds-modal__content slds-p-around_medium" id="modal-content-id-1">
        <div class="slds-form">
          <div class="slds-form-element slds-form-element_horizontal">
            <label class="slds-form-element__label" for="horizontal-input-id-01">Engagement List Criteria Title</label>
            <div class="slds-form-element__control">
              <input type="text" id="horizontal-input-id-01" placeholder="Placeholder text…" class="slds-input" />
            </div>
          </div>
          <div class="slds-form-element slds-form-element_horizontal">
            <label class="slds-form-element__label" for="horizontal-input-id-02">Description</label>
            <div class="slds-form-element__control">
              <textarea id="horizontal-input-id-02" placeholder="Placeholder text…" class="slds-textarea"></textarea>
              <div class="slds-grid slds-gutters">
                <div class="">
                  <lightning-input
                    type="file"
                    accept=".csv"
                    onchange={handleFileUpload}>
                  </lightning-input>
                </div>
                <div style="color:blue" class="slds-text-body_small slds-text-align_left slds-p-vertical_medium slds-p-left_small">{fileName}</div>
              </div>
            </div>
            <template if:true={showTabset}>
              <template if:false={loaded}>
                <lightning-spinner alternative-text="Loading"></lightning-spinner>
              </template>
              <template if:true={loaded}>
                <div class="slds-box slds-p-around_none slds-m-top_x-small slds-m-bottom_medium slds-m-horizontal_none">
                   <lightning-layout>
                      <lightning-layout-item flexibility="auto" padding="around-small">
                         <div class="custom-box">Summary</div>
                      </lightning-layout-item>
                      <lightning-layout-item flexibility="auto" padding="around-small">
                         <div class="custom-box">Rows: {studentsFound} </div>
                      </lightning-layout-item>
                      <lightning-layout-item flexibility="auto" padding="around-small">
                         <div class="custom-box">Student Found: {studentsFound} </div>
                      </lightning-layout-item>
                      <lightning-layout-item flexibility="auto" padding="around-small">
                         <div class="custom-box">Exclusions: {exclRowCount} </div>
                      </lightning-layout-item>
                   </lightning-layout>
                </div>
                <lightning-tabset>
                   <lightning-tab label="Students Found">
                      <div class="slds-grid slds-grid_vertical slds-clearfix">
                        <div class="slds-col slds-float_right">
                          <lightning-input 
                            class="slds-p-bottom_large"
                            name="Search"
                            type="search"
                            placeholder="search"
                            onchange={handleSearch}
                          ></lightning-input>
                        </div>
                        <lightning-card>
                          <table class="slds-table slds-table_cell-buffer slds-table_bordered" aria-labelledby="element-with-table-label other-element-with-table-label">
                            <thead>
                                <tr class="slds-line-height_reset">
                                    <th class="" scope="col">
                                      <div class="slds-truncate" title="QUT Student ID">QUT Student ID</div>
                                    </th>
                                    <th class="" scope="col">
                                      <div class="slds-truncate" title="Full Name">Full Name</div>
                                    </th>
                                    <th class="" scope="col">
                                      <div class="slds-truncate" title="QUT Learner Email">QUT Learner Email</div>
                                    </th>
                                    <th class="" scope="col">
                                      <div class="slds-truncate" title="Mobile">Mobile</div>
                                    </th>
                                    <th class="" scope="col">
                                      <div class="slds-truncate" title="Delete Action"></div>
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                <template for:each={data} for:item="data">
                                    <tr key={data.studentId}>
                                        <th data-label="QUT Student ID" scope="row">
                                          <div class="slds-truncate" title="Cloudhub" data-id={data.studentId}>
                                            {data.studentId}
                                          </div>
                                        </th>
                                        <td data-label="Full Name">
                                          <div class="slds-truncate" title="Cloudhub" data-id={data.studentId}>
                                            {data.fullName}
                                          </div>
                                        </td>
                                        <td data-label="QUT Learner Email">
                                          <div class="slds-truncate" title="Cloudhub" data-id={data.studentId}>
                                            {data.email}
                                          </div>
                                        </td>
                                        <td data-label="Mobile">
                                          <div class="slds-truncate" title="Cloudhub" data-id={data.studentId}>
                                            {data.mobilePhone}
                                          </div>
                                        </td>
                                        <td data-label="Delete Action">
                                          <div class="slds-truncate">
                                            <lightning-button-icon icon-name="action:delete"  alternative-text="Delete" title="Delete" data-id={data.studentId} onclick={handleDeleteAction}></lightning-button-icon>
                                          </div>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                          </table>
                        </lightning-card>
                      </div>
                   </lightning-tab>
                   <lightning-tab label="Exclusions" title="Exclusions">
                      <div style="height: 300px">
                        <lightning-card>
                          <table class="slds-table slds-table_cell-buffer slds-table_bordered" aria-labelledby="element-with-table-label other-element-with-table-label">
                            <thead>
                                <tr class="slds-line-height_reset">
                                    <th class="" scope="col">
                                      <div class="slds-truncate" title="Student ID">Student ID</div>
                                    </th>
                                    <th class="" scope="col">
                                      <div class="slds-truncate" title="Error">Error</div>
                                    </th>
                                </tr>
                            </thead>
                            <tbody>
                                <template for:each={exclusionData} for:item="exData">
                                    <tr key={exData.studentId}>
                                      <th data-label="QUT Student ID" scope="row">
                                        <div class="slds-truncate" title="Cloudhub" data-id={exData.studentId}>
                                          {exData.studentId}
                                        </div>
                                      </th>
                                      <td data-label="Full Name">
                                        <div class="slds-truncate" title="Cloudhub" data-id={exData.studentId}>
                                          {exData.error}
                                        </div>
                                      </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                        </lightning-card>
                      </div>
                   </lightning-tab>
                </lightning-tabset>
              </template>
            </template>
            
           <template if:true={errors.length}>
            <div class="slds-text-color_error slds-m-top_medium">
                <ul>
                    <template for:each={errors} for:item="error">
                        <li key={error}>{error}</li>
                    </template>
                </ul>
            </div>
        </template>
          </div>
        </div>
      </div>
      <div class="slds-modal__footer">
        <button class="slds-button slds-button_neutral" aria-label="Cancel and close" onclick={closeModal}>Cancel</button>
        <button class="slds-button slds-button_brand" disabled={isCreateButtonDisabled}>Create Outreach</button>
    </div>
    </div>
  </section>
  <div class={backdropClass} role="presentation"></div>

</template>
</template>