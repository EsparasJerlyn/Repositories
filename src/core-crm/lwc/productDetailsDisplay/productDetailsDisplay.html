<template>
  <div class="slds-container_x-large">
    <lightning-layout multiple-rows="true">
      <!-- Product Name -->
      <lightning-layout-item flexibility="auto" size="12">
        <h1 class="h1 main-color-blue500">{productDetails.Name}</h1>
      </lightning-layout-item>
      <!-- Sub Header -->
      <lightning-layout-item flexibility="auto" size="12">
        <h2 class="subHeader">{label.subHeader}</h2>
      </lightning-layout-item>
      <!-- Left: Overview, Core Concepts, Facilitator, Location, Details -->
      <lightning-layout-item
        flexibility="auto"
        size="12"
        medium-device-size="8"
      >
        <lightning-layout multiple-rows="true" class="leftColumn">
          <lightning-layout-item flexibility="auto" size="12">
            <ul class="slds-accordion">
              <!-- Overview -->
              <li
                if:true={productDetails.Overview__c}
                class="slds-accordion__list-item"
              >
                <section class="slds-accordion__section">
                  <div class="slds-accordion__summary">
                    <h2 class="slds-accordion__summary-heading">
                      <button
                        class="slds-button slds-button_reset slds-accordion__summary-action"
                        aria-controls="overviewContent"
                        aria-expanded="false"
                        title={label.overview}
                        onclick={handleAccordionToggle}
                      >
                        <span
                          class="slds-accordion__summary-content  h4"
                        >
                          {label.overview}
                        </span>
                        <img
                          src={accordionIcon}
                          alt=""
                          class="slds-accordion__summary-action-icon slds-button__icon"
                        />
                      </button>
                    </h2>
                  </div>
                  <div
                    hidden
                    class="slds-accordion__content accordionContent"
                    id="overviewContent"
                  >
                    <lightning-formatted-rich-text
                      value={productDetails.Overview__c}
                    >
                    </lightning-formatted-rich-text>
                  </div>
                </section>
              </li>
              <!-- Evolve With QUTeX -->
              <li
                if:true={productDetails.Evolve_with_QUTeX__c}
                class="slds-accordion__list-item"
              >
                <section class="slds-accordion__section">
                  <div class="slds-accordion__summary">
                    <h2 class="slds-accordion__summary-heading">
                      <button
                        class="slds-button slds-button_reset slds-accordion__summary-action"
                        aria-controls="evolveWithQUTeXContent"
                        aria-expanded="false"
                        title={label.evolveWithQUTeX}
                        onclick={handleAccordionToggle}
                      >
                        <span
                          class="slds-accordion__summary-content accordionHeader h4"
                        >
                          {label.evolveWithQUTeX}
                        </span>
                        <img
                          src={accordionIcon}
                          alt=""
                          class="slds-accordion__summary-action-icon slds-button__icon"
                        />
                      </button>
                    </h2>
                  </div>
                  <div
                    hidden
                    class="slds-accordion__content accordionContent"
                    id="evolveWithQUTeXContent"
                  >
                    <lightning-formatted-rich-text
                      value={productDetails.Evolve_with_QUTeX__c}
                    >
                    </lightning-formatted-rich-text>
                  </div>
                </section>
              </li>
              <!-- Who Should Participate -->
              <li
                if:true={productDetails.Who_Should_Participate__c}
                class="slds-accordion__list-item"
              >
                <section class="slds-accordion__section">
                  <div class="slds-accordion__summary">
                    <h2 class="slds-accordion__summary-heading">
                      <button
                        class="slds-button slds-button_reset slds-accordion__summary-action"
                        aria-controls="whoShouldParticipateContent"
                        aria-expanded="false"
                        title={label.whoShouldParticipate}
                        onclick={handleAccordionToggle}
                      >
                        <span
                          class="slds-accordion__summary-content accordionHeader h4"
                        >
                          {label.whoShouldParticipate}
                        </span>
                        <img
                          src={accordionIcon}
                          alt=""
                          class="slds-accordion__summary-action-icon slds-button__icon"
                        />
                      </button>
                    </h2>
                  </div>
                  <div
                    hidden
                    class="slds-accordion__content accordionContent"
                    id="whoShouldParticipateContent"
                  >
                    <lightning-formatted-rich-text
                      value={productDetails.Who_Should_Participate__c}
                    >
                    </lightning-formatted-rich-text>
                  </div>
                </section>
              </li>
              <!-- Core concepts -->
              <li
                if:true={productDetails.Core_Concepts__c}
                class="slds-accordion__list-item"
              >
                <section class="slds-accordion__section">
                  <div class="slds-accordion__summary">
                    <h2 class="slds-accordion__summary-heading">
                      <button
                        class="slds-button slds-button_reset slds-accordion__summary-action"
                        aria-controls="coreConceptsContent"
                        aria-expanded="false"
                        title={label.coreConcepts}
                        onclick={handleAccordionToggle}
                      >
                        <span
                          class="slds-accordion__summary-content accordionHeader h4"
                        >
                          {label.coreConcepts}
                        </span>
                        <img
                          src={accordionIcon}
                          alt=""
                          class="slds-accordion__summary-action-icon slds-button__icon"
                        />
                      </button>
                    </h2>
                  </div>
                  <div
                    hidden
                    class="slds-accordion__content accordionContent"
                    id="coreConceptsContent"
                  >
                    <lightning-formatted-rich-text
                      value={productDetails.Core_Concepts__c}
                    >
                    </lightning-formatted-rich-text>
                  </div>
                </section>
              </li>
              <!-- Facilitator -->
              <li if:true={facilitator} class="slds-accordion__list-item">
                <section class="slds-accordion__section">
                  <div class="slds-accordion__summary">
                    <h2 class="slds-accordion__summary-heading">
                      <button
                        class="slds-button slds-button_reset slds-accordion__summary-action"
                        aria-controls="facilitatorContent"
                        aria-expanded="false"
                        title={label.facilitator}
                        onclick={handleAccordionToggle}
                      >
                        <span
                          class="slds-accordion__summary-content accordionHeader h4"
                        >
                          {label.facilitator}
                        </span>
                        <img
                          src={accordionIcon}
                          alt=""
                          class="slds-accordion__summary-action-icon slds-button__icon"
                        />
                      </button>
                    </h2>
                  </div>
                  <div
                    hidden
                    class="slds-accordion__content accordionContent"
                    id="facilitatorContent"
                  >
                    <div class="slds-media">
                      <div class="slds-media__figure slds-m-right_x-large">
                        <img
                          alt=""
                          class="facilImage"
                          src={facilitator.facilitatorImage}
                        />
                      </div>
                      <div class="slds-media__body">
                        <lightning-button-icon
                          if:true={displayFacilitatorNav}
                          icon-name="utility:chevronright"
                          alternative-text="Next"
                          onclick={handleNextFacilitator}
                          title="Next"
                          class="slds-float_right"
                        ></lightning-button-icon>
                        <lightning-button-icon
                          if:true={displayFacilitatorNav}
                          icon-name="utility:chevronleft"
                          alternative-text="Previous"
                          onclick={handlePreviousFacilitator}
                          title="Previous"
                          class="slds-float_right slds-m-right_small"
                        ></lightning-button-icon>
                        <h4 class="slds-m-bottom_medium facilName">
                          {facilitator.facilitatorName}
                        </h4>
                        <p class="facilBio">{facilitator.facilitatorBio}</p>
                      </div>
                    </div>
                  </div>
                </section>
              </li>
              <!-- Location -->
              <li
                if:true={selectedCourseOfferingLocation}
                class="slds-accordion__list-item"
              >
                <section class="slds-accordion__section">
                  <div class="slds-accordion__summary">
                    <h2 class="slds-accordion__summary-heading">
                      <button
                        class="slds-button slds-button_reset slds-accordion__summary-action"
                        aria-controls="locationContent"
                        aria-expanded="false"
                        title={label.location}
                        onclick={handleAccordionToggle}
                      >
                        <span
                          class="slds-accordion__summary-content accordionHeader h4"
                        >
                          {label.location}
                        </span>
                        <img
                          src={accordionIcon}
                          alt=""
                          class="slds-accordion__summary-action-icon slds-button__icon"
                        />
                      </button>
                    </h2>
                  </div>
                  <div
                    hidden
                    class="slds-accordion__content accordionContent"
                    id="locationContent"
                  >
                    <lightning-formatted-rich-text
                      value={selectedCourseOfferingLocation}
                    >
                    </lightning-formatted-rich-text>
                  </div>
                </section>
              </li>
              <!-- Details -->
              <li
                if:true={productDetails.More_Details__c}
                class="slds-accordion__list-item"
              >
                <section class="slds-accordion__section">
                  <div class="slds-accordion__summary">
                    <h2 class="slds-accordion__summary-heading">
                      <button
                        class="slds-button slds-button_reset slds-accordion__summary-action"
                        aria-controls="detailsContent"
                        aria-expanded="false"
                        title={label.details}
                        onclick={handleAccordionToggle}
                      >
                        <span
                          class="slds-accordion__summary-content accordionHeader h4"
                        >
                          {label.details}
                        </span>
                        <img
                          src={accordionIcon}
                          alt=""
                          class="slds-accordion__summary-action-icon slds-button__icon"
                        />
                      </button>
                    </h2>
                  </div>
                  <div
                    hidden
                    class="slds-accordion__content accordionContent"
                    id="detailsContent"
                  >
                    <lightning-formatted-rich-text
                      value={productDetails.More_Details__c}
                    >
                    </lightning-formatted-rich-text>
                  </div>
                </section>
              </li>
            </ul>
          </lightning-layout-item>
        </lightning-layout>
      </lightning-layout-item>
      <!-- Right: Duration, Delivery, Available Start Dates, Pricing & Add to Cart -->
      <lightning-layout-item
        flexibility="auto"
        size="12"
        medium-device-size="4"
      >
        <lightning-layout multiple-rows="true" class="rightColumn">
          <!-- Duration -->
          <lightning-layout-item
            flexibility="auto"
            size="12"
            class="slds-m-bottom_small"
          >
            <div class="slds-media slds-has-flexi-truncate">
              <div class="slds-media__figure">
                <span class="slds-icon_container">
                  <img alt="" src={durationIcon} />
                </span>
              </div>
              <div class="slds-media__body">
                <div class="slds-card__header-title">
                  <span class="durationTitle">{label.duration}</span>
                </div>
                <div class="slds-m-top_x-small durationValue">
                  {productDetails.Duration__c}
                </div>
              </div>
            </div>
          </lightning-layout-item>
          <!-- Delivery -->
          <lightning-layout-item
            flexibility="auto"
            size="12"
            class="slds-m-bottom_small"
          >
            <c-custom-combobox-multi
              class=""
              label={label.delivery}
              placeholder={label.deliveryPlaceholder}
              disabled={disableDelivery}
              options={deliveryOptions}
              onchange={handleDeliverySelected}
              slds-icon-up="utility:chevronup"
              slds-icon-down="utility:chevrondown"
            ></c-custom-combobox-multi>
          </lightning-layout-item>
          <!-- Available Start Dates -->
          <lightning-layout-item
            flexibility="auto"
            size="12"
            class="slds-m-bottom_small"
          >
            <c-custom-combobox
              class="availStartDates"
              field-label={label.availableStartDates}
              placeholder={label.availableStartDatesPlaceholder}
              disabled={disableAvailStartDate}
              options={courseOfferings}
              value={selectedCourseOffering}
              onchange={handleStartDateSelected}
              slds-icon-up="utility:chevronup"
              slds-icon-down="utility:chevrondown"
            >
            </c-custom-combobox>
          </lightning-layout-item>
          <!-- Pricing -->
          <lightning-layout-item
            flexibility="auto"
            size="12"
            class="slds-m-bottom_small"
          >
            <c-custom-combobox
              class="pricing"
              field-label={label.pricing}
              placeholder={label.pricingPlaceholder}
              disabled={disablePriceBookEntry}
              options={priceBookEntries}
              value={selectedPriceBookEntry}
              onchange={handlePricebookSelected}
              slds-icon-up="utility:chevronup"
              slds-icon-down="utility:chevrondown"
            >
            </c-custom-combobox>
          </lightning-layout-item>
          <!-- Add to Cart -->
          <template if:true={cartVisible}>
            <lightning-layout-item
              if:true={displayAddToCart}
              flexibility="auto"
              size="12"
            >
              <lightning-button
                label={label.addToCart}
                disabled={disableAddToCart}
                onclick={notifyAddToCart}
                variant="brand"
                class="addToCartBtn"
              ></lightning-button>
            </lightning-layout-item>
          </template>
          <template if:false={cartVisible}>
          <lightning-layout-item
          
            flexibility="auto"
            size="12"
          >
            <lightning-button
              label="APPLY"
              disabled={disableAddToCart}
              onclick={notifyApply}
              variant="brand"
              class="addToCartBtn"
            ></lightning-button>
          </lightning-layout-item>
          </template>
          <!-- Register Interest -->
          <lightning-layout-item
            if:true={displayRegisterInterest}
            flexibility="auto"
            size="12"
          >
            <lightning-button
              label={label.registerInterest}
              onclick={registerInterest}
              variant="brand"
              class="registerInterest"
            ></lightning-button>
          </lightning-layout-item>
        </lightning-layout>
      </lightning-layout-item>
    </lightning-layout>
  </div>
  <!-- Custom Login Form LWC for Guest User -->
  <template if:true={openModal}>
    <c-registration-form onclose={handleModalClosed}></c-registration-form>
  </template>
    <!--Questionnaire Form  -->
    <lightning-spinner if:true={isLoading} alternative-text="Loading" size="small"></lightning-spinner>
 
    <template if:true={isModalOpen}>
      <section class="slds-modal slds-fade-in-open">
          <div class="slds-modal__container">
             <template if:true={isRespondQuestions}>
                  <header class="slds-modal__header">
                      <button class="slds-button slds-button_icon slds-modal__close slds-button_icon-inverse" title="Close" onclick={closeManageResponse}>
                          <lightning-icon icon-name="utility:close" alternative-text="close" variant="inverse" size="small"></lightning-icon>
                      </button>
                      <h2 class="slds-text-heading_medium slds-hyphenate">Application Questions</h2>
                  </header>
                  <div class="slds-is-relative">
                      <lightning-spinner if:true={saveInProgress} alternative-text="Loading" size="small"></lightning-spinner>
                      <div class="slds-modal__content slds-p-around_medium">
                          <template if:true={hasQuestions}>
                              <lightning-layout multiple-rows size="12">
                                  <template for:each={questions} for:item="question">
                                      <lightning-layout-item size="6" padding="around-small" key={question.Id}>
                                          <template if:true={question.IsText}>
                                              <lightning-textarea 
                                              name={question.Id} 
                                              label={question.Label} 
                                              required 
                                              onchange={handleChange}
                                              onblur={handleBlur}>
                                              </lightning-textarea>
                                          </template>
                                          <template if:true={question.IsNumber}>
                                              <lightning-input 
                                              name={question.Id} 
                                              type="number" 
                                              label={question.Label} 
                                              required 
                                              onchange={handleChange}
                                              onblur={handleBlur}>
                                              </lightning-input>
                                          </template>
                                          <template if:true={question.IsDate}>
                                              <lightning-input 
                                              name={question.Id} 
                                              type="date" 
                                              label={question.Label} 
                                              required onchange={handleChange}
                                              onblur={handleBlur}>
                                          </lightning-input>
                                          </template>
                                          <template if:true={question.IsPicklist}>
                                              <lightning-combobox
                                                  name={question.Id}
                                                  label={question.Label}
                                                  value={question.Response}
                                                  placeholder="Select Option"
                                                  options={question.Options}
                                                  onchange={handleChange} 
                                                  onblur={handleBlur}
                                                  required>
                                              </lightning-combobox>
                                          </template>
                                          <template if:true={question.IsMultiPicklist}>
                                              <abbr title="required" class="slds-required">*</abbr>
                                              <span data-id={question.Id} class="slds-form-element__label" >{question.Label}</span>
                                              <lightning-dual-listbox 
                                                  data-id={question.Id}
                                                  name={question.Id}
                                                  variant="label-hidden"
                                                  class="normal-font"
                                                  source-label="Available"
                                                  selected-label="Selected"
                                                  options={question.Options}
                                                  onchange={handleChange}
                                                  onblur={handleBlur}
                                                  required>
                                              </lightning-dual-listbox>
                                          </template>
                                          <template if:true={question.IsCheckbox}>
                                              <lightning-input 
                                              name={question.Id} 
                                              type="checkbox" 
                                              label={question.Label} 
                                              onchange={handleChange}
                                              onblur={handleBlur}
                                              variant="label-stacked">
                                          </lightning-input>
                                          </template>
                                          <template if:true={question.IsFileUpload}>
                                              <lightning-input 
                                              name ={question.Id}
                                              type="file" 
                                              accept=".xlsx, .xls, .csv, .png, .doc, .docx, .pdf"
                                              label={question.Label} 
                                              required 
                                              onchange={handleChange}
                                              onblur={handleBlur}>
                                              </lightning-input>
                                              <template if:true={question.FileData}>
                                                  <lightning-icon 
                                                      icon-name="utility:success" 
                                                      alternative-text="Success!" 
                                                      variant="success"
                                                      title="success variant xx-small" 
                                                      size="xx-small">
                                                  </lightning-icon>
                                                  <span class="slds-form-element__label">{question.FileData.filename}</span>
                                              </template>
                                          </template>
                                          <template if:true={question.ErrorMessage}>
                                              <p class="slds-form-element__help slds-text-color_destructive">{question.ErrorMessage}</p>
                                          </template>
                                      </lightning-layout-item>
                                  </template>
                              </lightning-layout>
                          </template>
                      </div>
                      <footer class="slds-modal__footer">
                          <div class="slds-var-top_medium">
                              <lightning-button 
                                  label="Save"
                                  type="Submit"
                                  variant="brand"
                                  onclick={handleSaveResponse}
                                  disabled={disableResponseSave}
                              ></lightning-button>
                          </div>
                      </footer>
                  </div>
              </template>
          </div>
      </section>
      <div class="slds-backdrop slds-backdrop_open"></div>
  </template>
    <!--Questionnaire Form  --> 
</template>
