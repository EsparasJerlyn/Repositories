<template>
    <div class="slds-modal slds-fade-in-open slds-backdrop">  
        <div class="slds-modal__container">  
            <!--Header Section-->  
            <div class="slds-modal__header">  
                <lightning-button-icon
                    icon-name="utility:close"
                    alternative-text="Close this window"
                    size="large"  
                    variant="bare-inverse"
                    onclick={closeModal}
                    class="slds-modal__close">  
                </lightning-button-icon>  
                <h2>{modalHeader}</h2>  
            </div>  
            <!--Body Section-->  
            <div class="slds-modal__content slds-p-around_medium">
                <!--Record Type Selection Section-->
                <template if:true={showRecordTypeSelection} for:each={recordTypeSelection} for:item="recType">
                    <fieldset key={recType.value}>
                      <div class="slds-m-left_large slds-form-element__control">
                        <span class="slds-radio slds-p-bottom_medium slds-text-heading_medium" >
                          <input name="radiogroup" id={recType.value} type="radio" value={recType.value} checked={recType.checked} onchange={getSelectedRecordType}/>
                          <label class="slds-radio__label" for={recType.value}>
                            <span class="slds-radio_faux"></span>
                            <span class="slds-form-element__label">{recType.label}</span>
                          </label>
                        </span>
                      </div>
                    </fieldset>
                </template>
                <div if:true={showRecordTypeSelection} class="slds-float_right slds-m-top_large">
                    <lightning-button
                        label="Create"  
                        variant="brand"
                        onclick={showPageLayout} 
                        disabled={disableCreateButton}>
                    </lightning-button>
                </div>
                <!--Record Create/Edit Section-->
                <template if:false={showRecordTypeSelection}>
                    <lightning-record-edit-form object-api-name={objectApiName} record-id={recordId} onsubmit={handleSubmit} onchange={handleChange}>
                        <lightning-accordion allow-multiple-sections-open active-section-name={activeSections}>
                            <lightning-spinner if:true={isLoading} alternative-text="Loading" size="medium"></lightning-spinner> 
                            <template for:each={layoutToDisplay} for:item="layoutItem">
                                <lightning-accordion-section key={layoutItem.sectionLabel} name={layoutItem.sectionLabel} label={layoutItem.sectionLabel} class="accordion-section">
                                    <div class="slds-grid slds-gutters">
                                        <div class="slds-col slds-size_1-of-2">
                                            <template for:each={layoutItem.leftColumn} for:item="leftField">
                                                <lightning-input-field 
                                                    if:false={recordId}
                                                    key={leftField.field}
                                                    field-name={leftField.field}
                                                    value={leftField.value}
                                                    disabled={leftField.readOnly}
                                                    required={leftField.mandatory}>
                                                </lightning-input-field>
                                                <lightning-input-field 
                                                    if:true={recordId}
                                                    key={leftField.field}
                                                    field-name={leftField.field}
                                                    disabled={leftField.readOnly}
                                                    required={leftField.mandatory}>
                                                </lightning-input-field>
                                            </template>
                                        </div>
                                        <div class="slds-col slds-size_1-of-2">
                                            <template for:each={layoutItem.rightColumn} for:item="rightField">
                                                <lightning-input-field
                                                    if:false={recordId} 
                                                    key={rightField.field}
                                                    field-name={rightField.field}
                                                    value={rightField.value}
                                                    disabled={rightField.readOnly}
                                                    required={rightField.mandatory}>
                                                </lightning-input-field>
                                                <lightning-input-field
                                                    if:true={recordId}
                                                    key={rightField.field}
                                                    field-name={rightField.field}
                                                    disabled={rightField.readOnly}
                                                    required={rightField.mandatory}>
                                                </lightning-input-field>
                                            </template>
                                        </div>
                                        <div class="slds-col slds-size_1-of-1">
                                            <template for:each={layoutItem.singleColumn} for:item="singleField">
                                                <lightning-input-field
                                                    if:false={recordId} 
                                                    key={singleField.field}
                                                    field-name={singleField.field}
                                                    value={singleField.value}
                                                    disabled={singleField.readOnly}
                                                    required={singleField.mandatory}>
                                                </lightning-input-field>
                                                <lightning-input-field 
                                                    if:true={recordId}
                                                    key={singleField.field}
                                                    field-name={singleField.field}
                                                    disabled={singleField.readOnly}
                                                    required={singleField.mandatory}>
                                                </lightning-input-field>
                                            </template>
                                        </div>
                                    </div>
                                </lightning-accordion-section>
                            </template>
                        </lightning-accordion>
                        <div class="slds-m-top_large">
                            <lightning-button
                                    if:true={showBackButton}
                                    label="Back"
                                    variant="neutral"
                                    icon-name="utility:back"
                                    icon-position="left"
                                    onclick={handleBack}>  
                            </lightning-button>
                            <div class="slds-float_right">
                                <lightning-button
                                    label="Cancel"
                                    variant="neutral"
                                    onclick={closeModal}>  
                                </lightning-button>
                                <lightning-button
                                    if:true={showSaveAndNewButton}
                                    data-name="saveAndNew"
                                    label="Save &amp; New"
                                    variant="brand-outline"
                                    onclick={storeButtonName}
                                    type="submit"
                                    class="slds-m-left_medium"
                                    disabled={isDisabled}>  
                                </lightning-button>
                                <lightning-button
                                    data-name="save"
                                    label="Save"
                                    variant="brand"
                                    onclick={storeButtonName}
                                    type="submit"
                                    class="slds-m-left_medium"
                                    disabled={isDisabled}>  
                                </lightning-button>
                            </div>
                        </div>
                    </lightning-record-edit-form>
                </template>
            </div>  
        </div>  
    </div>  
</template>